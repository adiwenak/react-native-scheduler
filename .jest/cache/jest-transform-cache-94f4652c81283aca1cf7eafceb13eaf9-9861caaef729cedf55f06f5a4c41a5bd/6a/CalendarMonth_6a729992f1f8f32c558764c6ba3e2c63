c679ff7632cd25270c1d10b900b70d7d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CalendarMonth = void 0;

var tslib_1 = _interopRequireWildcard(require("tslib"));

var _moment = _interopRequireDefault(require("moment"));

var React = _interopRequireWildcard(require("react"));

var _reactNative = require("react-native");

var _CalendarMonth = require("./CalendarMonth.styles");

var _DateCalendarBox = require("./DateCalendarBox");

var _MonthSelection = require("./MonthSelection");

var _WeekDayHeader = require("./WeekDayHeader");

var nBoxToDateMapper = function nBoxToDateMapper(year, month, scheduleToUserMap, selectedDate) {
  var date = new Date(year, month, 1);
  var result = {};
  var startDayOfTheMonth = date.getDay();

  while (date.getMonth() === month) {
    var currentDay = date.getDay();
    var ms = date.getTime();
    var usersBusy = [];
    var isWeekend = false;
    var isSelected = date.getDate() === selectedDate;

    if (currentDay === 0 || currentDay === 6) {
      isWeekend = true;
    }

    if (scheduleToUserMap[ms]) {
      usersBusy = scheduleToUserMap[ms];
    }

    result[startDayOfTheMonth] = {
      dateNumber: date.getDate(),
      isWeekend: isWeekend,
      usersBusy: usersBusy,
      isSelected: isSelected
    };
    startDayOfTheMonth += 1;
    date.setDate(date.getDate() + 1);
  }

  return result;
};

var flattenTaskSchedule = function flattenTaskSchedule(data) {
  var mapped = {};
  data.forEach(function (value) {
    value.tasks.forEach(function (task) {
      var dateOnly = new Date(task.startTime.getFullYear(), task.startTime.getMonth(), task.startTime.getDate());
      var ms = dateOnly.getTime();
      var arrayUser = [];

      if (!mapped[ms]) {
        arrayUser = [];
      } else {
        arrayUser = mapped[ms].slice();
      }

      arrayUser.push(value.user);
      mapped[ms] = arrayUser;
    });
  });
  return mapped;
};

var CalendarMonth = function (_super) {
  tslib_1.__extends(CalendarMonth, _super);

  function CalendarMonth(props) {
    var _this = _super.call(this, props) || this;

    _this.boxes = 35;

    _this.containerOnLayout = function (event) {
      var dateBoxWidth = event.nativeEvent.layout.width / 7.01;

      _this.setState({
        dateBoxWidth: dateBoxWidth
      });
    };

    _this.onMonthChange = function (month, year) {
      _this.setState({
        currentMonth: month,
        currentYear: year,
        selectedDate: undefined
      });
    };

    _this.onDatePress = function (date) {
      _this.setState({
        selectedDate: date
      });
    };

    var today = (0, _moment.default)();
    _this.state = {
      dateBoxWidth: 0,
      currentMonth: today.month(),
      currentYear: today.year()
    };
    return _this;
  }

  CalendarMonth.prototype.generateBoxes = function (data) {
    var all = nBoxToDateMapper(this.state.currentYear, this.state.currentMonth, data, this.state.selectedDate);
    var n = 0;
    var els = [];

    while (n < this.boxes) {
      var obj = all[n];
      var el = void 0;

      if (obj) {
        el = React.createElement(_DateCalendarBox.DateCalendarBox, {
          key: "date-" + n,
          date: obj.dateNumber,
          boxWidth: this.state.dateBoxWidth,
          dateFontSize: 13,
          isSelected: obj.isSelected,
          isWeekend: obj.isWeekend,
          whosBusy: obj.usersBusy,
          dateBoxOnPressHandler: this.onDatePress
        });
      } else {
        el = React.createElement(_DateCalendarBox.DateCalendarBox, {
          key: "date-" + n,
          boxWidth: this.state.dateBoxWidth,
          dateFontSize: 12,
          isSelected: false,
          isWeekend: false,
          whosBusy: [],
          dateBoxOnPressHandler: this.onDatePress
        });
      }

      els.push(el);
      n += 1;
    }

    return els;
  };

  CalendarMonth.prototype.render = function () {
    var indicator = {};

    if (this.props.data) {
      indicator = flattenTaskSchedule(this.props.data);
    }

    var boxes = this.generateBoxes(indicator);
    return React.createElement(_reactNative.View, {
      style: _CalendarMonth.styles.container
    }, React.createElement(_reactNative.View, {
      style: _CalendarMonth.styles.containerMonthSelection
    }, React.createElement(_MonthSelection.MonthSelection, {
      onMonthChange: this.onMonthChange,
      currentMonth: this.state.currentMonth,
      currentYear: this.state.currentYear
    })), React.createElement(_reactNative.View, {
      style: _CalendarMonth.styles.containerWeekday
    }, React.createElement(_WeekDayHeader.WeekDayHeader, null)), React.createElement(_reactNative.View, {
      onLayout: this.containerOnLayout,
      style: _CalendarMonth.styles.containerDates
    }, boxes.map(function (value) {
      return value;
    })));
  };

  return CalendarMonth;
}(React.Component);

exports.CalendarMonth = CalendarMonth;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ha3VybmFkaS9Qcm9qZWN0cy9yZWFjdC1uYXRpdmUtc2NoZWR1bGVyL2xpYnJhcnkvQ2FsZW5kYXJNb250aC9DYWxlbmRhck1vbnRoLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQWlDQSxJQUFNLGdCQUFnQixHQUFHLFNBQW5CLGdCQUFtQixDQUFDLElBQUQsRUFBZSxLQUFmLEVBQ0MsaUJBREQsRUFFQyxZQUZELEVBRTBCO0FBQy9DLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSixDQUFTLElBQVQsRUFBZSxLQUFmLEVBQXNCLENBQXRCLENBQWI7QUFDQSxNQUFNLE1BQU0sR0FBdUIsRUFBbkM7QUFDQSxNQUFJLGtCQUFrQixHQUFHLElBQUksQ0FBQyxNQUFMLEVBQXpCOztBQUNBLFNBQU8sSUFBSSxDQUFDLFFBQUwsT0FBb0IsS0FBM0IsRUFBa0M7QUFDOUIsUUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQUwsRUFBbkI7QUFDQSxRQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBTCxFQUFYO0FBQ0EsUUFBSSxTQUFTLEdBQVcsRUFBeEI7QUFDQSxRQUFJLFNBQVMsR0FBRyxLQUFoQjtBQUNBLFFBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFMLE9BQW1CLFlBQXRDOztBQUNBLFFBQUksVUFBVSxLQUFLLENBQWYsSUFBb0IsVUFBVSxLQUFLLENBQXZDLEVBQTBDO0FBQ3RDLE1BQUEsU0FBUyxHQUFHLElBQVo7QUFDSDs7QUFFRCxRQUFJLGlCQUFpQixDQUFDLEVBQUQsQ0FBckIsRUFBMkI7QUFDdkIsTUFBQSxTQUFTLEdBQUcsaUJBQWlCLENBQUMsRUFBRCxDQUE3QjtBQUNIOztBQUVELElBQUEsTUFBTSxDQUFDLGtCQUFELENBQU4sR0FBNkI7QUFDekIsTUFBQSxVQUFVLEVBQUUsSUFBSSxDQUFDLE9BQUwsRUFEYTtBQUV6QixNQUFB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aW1wb3J0ICogYXMgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7IExheW91dENoYW5nZUV2ZW50LCBWaWV3IH0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQgeyBEYXRlTnVtYmVyLCBNb250aCwgVGFzaywgVXNlciB9IGZyb20gXCIuLi9zaGFyZWQvbW9kZWxcIlxuaW1wb3J0IHsgc3R5bGVzIH0gZnJvbSBcIi4vQ2FsZW5kYXJNb250aC5zdHlsZXNcIlxuaW1wb3J0IHsgRGF0ZUNhbGVuZGFyQm94IH0gZnJvbSBcIi4vRGF0ZUNhbGVuZGFyQm94XCJcbmltcG9ydCB7IE1vbnRoU2VsZWN0aW9uIH0gZnJvbSBcIi4vTW9udGhTZWxlY3Rpb25cIlxuaW1wb3J0IHsgV2Vla0RheUhlYWRlciB9IGZyb20gXCIuL1dlZWtEYXlIZWFkZXJcIlxuXG5leHBvcnQgaW50ZXJmYWNlIFRhc2tBbmRVc2VyIHtcbiAgICB1c2VyOiBVc2VyLFxuICAgIHRhc2tzOiBUYXNrW11cbn1cblxuaW50ZXJmYWNlIENhbGVuZGFyTW9udGhQcm9wcyB7XG4gICAgZGF0YT86IFRhc2tBbmRVc2VyW11cbn1cblxuaW50ZXJmYWNlIENhbGVuZGFyTW9udGhTdGF0ZSB7XG4gICAgZGF0ZUJveFdpZHRoOiBudW1iZXIsXG4gICAgc2VsZWN0ZWREYXRlPzogRGF0ZU51bWJlcixcbiAgICBjdXJyZW50TW9udGg6IE1vbnRoLFxuICAgIGN1cnJlbnRZZWFyOiBudW1iZXIsXG59XG5cbmludGVyZmFjZSBCb3hUb0RhdGVOdW1iZXJNYXAge1xuICAgIFtrZXk6IG51bWJlcl06IERhdGVPYmplY3Rcbn1cblxuaW50ZXJmYWNlIFNjaGVkdWxlVG9Vc2VyTWFwIHtcbiAgICBba2V5OiBudW1iZXJdOiBVc2VyW11cbn1cblxuaW50ZXJmYWNlIERhdGVPYmplY3Qge1xuICAgIGRhdGVOdW1iZXI6IERhdGVOdW1iZXJcbiAgICBpc1dlZWtlbmQ6IGJvb2xlYW5cbiAgICB1c2Vyc0J1c3k6IFVzZXJbXVxuICAgIGlzU2VsZWN0ZWQ6IGJvb2xlYW5cbn1cblxuY29uc3QgbkJveFRvRGF0ZU1hcHBlciA9ICh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlVG9Vc2VyTWFwOiBTY2hlZHVsZVRvVXNlck1hcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWREYXRlPzogRGF0ZU51bWJlcik6IEJveFRvRGF0ZU51bWJlck1hcCA9PiB7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCAxKVxuICAgIGNvbnN0IHJlc3VsdDogQm94VG9EYXRlTnVtYmVyTWFwID0ge31cbiAgICBsZXQgc3RhcnREYXlPZlRoZU1vbnRoID0gZGF0ZS5nZXREYXkoKVxuICAgIHdoaWxlIChkYXRlLmdldE1vbnRoKCkgPT09IG1vbnRoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREYXkgPSBkYXRlLmdldERheSgpXG4gICAgICAgIGNvbnN0IG1zID0gZGF0ZS5nZXRUaW1lKClcbiAgICAgICAgbGV0IHVzZXJzQnVzeTogVXNlcltdID0gW11cbiAgICAgICAgbGV0IGlzV2Vla2VuZCA9IGZhbHNlXG4gICAgICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBkYXRlLmdldERhdGUoKSA9PT0gc2VsZWN0ZWREYXRlXG4gICAgICAgIGlmIChjdXJyZW50RGF5ID09PSAwIHx8IGN1cnJlbnREYXkgPT09IDYpIHtcbiAgICAgICAgICAgIGlzV2Vla2VuZCA9IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzY2hlZHVsZVRvVXNlck1hcFttc10pIHtcbiAgICAgICAgICAgIHVzZXJzQnVzeSA9IHNjaGVkdWxlVG9Vc2VyTWFwW21zXVxuICAgICAgICB9XG5cbiAgICAgICAgcmVzdWx0W3N0YXJ0RGF5T2ZUaGVNb250aF0gPSB7XG4gICAgICAgICAgICBkYXRlTnVtYmVyOiBkYXRlLmdldERhdGUoKSBhcyBEYXRlTnVtYmVyLFxuICAgICAgICAgICAgaXNXZWVrZW5kLFxuICAgICAgICAgICAgdXNlcnNCdXN5LFxuICAgICAgICAgICAgaXNTZWxlY3RlZFxuICAgICAgICB9XG5cbiAgICAgICAgc3RhcnREYXlPZlRoZU1vbnRoICs9IDFcbiAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgMSlcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdFxufVxuXG5jb25zdCBmbGF0dGVuVGFza1NjaGVkdWxlID0gKGRhdGE6IFRhc2tBbmRVc2VyW10pOiBTY2hlZHVsZVRvVXNlck1hcCA9PiB7XG4gICAgY29uc3QgbWFwcGVkOiBTY2hlZHVsZVRvVXNlck1hcCA9IHt9XG4gICAgZGF0YS5mb3JFYWNoKCh2YWx1ZTogVGFza0FuZFVzZXIpID0+IHtcbiAgICAgICAgdmFsdWUudGFza3MuZm9yRWFjaCgodGFzazogVGFzaykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0ZU9ubHkgPSBuZXcgRGF0ZSh0YXNrLnN0YXJ0VGltZS5nZXRGdWxsWWVhcigpLCB0YXNrLnN0YXJ0VGltZS5nZXRNb250aCgpLCB0YXNrLnN0YXJ0VGltZS5nZXREYXRlKCkpXG4gICAgICAgICAgICBjb25zdCBtcyA9IGRhdGVPbmx5LmdldFRpbWUoKVxuICAgICAgICAgICAgbGV0IGFycmF5VXNlcjogVXNlcltdID0gW11cbiAgICAgICAgICAgIGlmICghbWFwcGVkW21zXSkge1xuICAgICAgICAgICAgICAgIGFycmF5VXNlciA9IFtdXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFycmF5VXNlciA9IFsuLi5tYXBwZWRbbXNdXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhcnJheVVzZXIucHVzaCh2YWx1ZS51c2VyKVxuICAgICAgICAgICAgbWFwcGVkW21zXSA9IGFycmF5VXNlclxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICByZXR1cm4gbWFwcGVkXG59XG5cbmV4cG9ydCBjbGFzcyBDYWxlbmRhck1vbnRoIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PENhbGVuZGFyTW9udGhQcm9wcywgQ2FsZW5kYXJNb250aFN0YXRlPiB7XG4gICAgcHJpdmF0ZSBib3hlcyA9IDM1XG4gICAgY29uc3RydWN0b3IocHJvcHM6IENhbGVuZGFyTW9udGhQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcylcbiAgICAgICAgY29uc3QgdG9kYXkgPSBtb21lbnQoKVxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZGF0ZUJveFdpZHRoOiAwLFxuICAgICAgICAgICAgY3VycmVudE1vbnRoOiB0b2RheS5tb250aCgpLFxuICAgICAgICAgICAgY3VycmVudFllYXI6IHRvZGF5LnllYXIoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVCb3hlcyhkYXRhOiBTY2hlZHVsZVRvVXNlck1hcCkge1xuICAgICAgICBjb25zdCBhbGwgPSBuQm94VG9EYXRlTWFwcGVyKHRoaXMuc3RhdGUuY3VycmVudFllYXIsIHRoaXMuc3RhdGUuY3VycmVudE1vbnRoLFxuICAgICAgICAgICAgZGF0YSwgdGhpcy5zdGF0ZS5zZWxlY3RlZERhdGUpXG4gICAgICAgIGxldCBuID0gMFxuICAgICAgICBjb25zdCBlbHMgPSBbXVxuICAgICAgICB3aGlsZSAobiA8IHRoaXMuYm94ZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IG9iaiA9IGFsbFtuXVxuICAgICAgICAgICAgbGV0IGVsXG4gICAgICAgICAgICBpZiAob2JqKSB7XG4gICAgICAgICAgICAgICAgZWwgPSAoXG4gICAgICAgICAgICAgICAgICAgIDxEYXRlQ2FsZW5kYXJCb3hcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleT17YGRhdGUtJHtufWB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlPXtvYmouZGF0ZU51bWJlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJveFdpZHRoPXt0aGlzLnN0YXRlLmRhdGVCb3hXaWR0aH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVGb250U2l6ZT17MTN9XG4gICAgICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdGVkPXtvYmouaXNTZWxlY3RlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzV2Vla2VuZD17b2JqLmlzV2Vla2VuZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdob3NCdXN5PXtvYmoudXNlcnNCdXN5fVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUJveE9uUHJlc3NIYW5kbGVyPXt0aGlzLm9uRGF0ZVByZXNzfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsID0gKFxuICAgICAgICAgICAgICAgICAgICA8RGF0ZUNhbGVuZGFyQm94XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2BkYXRlLSR7bn1gfVxuICAgICAgICAgICAgICAgICAgICAgICAgYm94V2lkdGg9e3RoaXMuc3RhdGUuZGF0ZUJveFdpZHRofVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZvbnRTaXplPXsxMn1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ9e2ZhbHNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgaXNXZWVrZW5kPXtmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdob3NCdXN5PXtbXX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVCb3hPblByZXNzSGFuZGxlcj17dGhpcy5vbkRhdGVQcmVzc31cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzLnB1c2goZWwpXG4gICAgICAgICAgICBuICs9IDFcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBlbHNcbiAgICB9XG5cbiAgICBjb250YWluZXJPbkxheW91dCA9IChldmVudDogTGF5b3V0Q2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgZGF0ZUJveFdpZHRoID0gZXZlbnQubmF0aXZlRXZlbnQubGF5b3V0LndpZHRoIC8gNy4wMVxuICAgICAgICB0aGlzLnNldFN0YXRlKHtkYXRlQm94V2lkdGh9KVxuICAgIH1cblxuICAgIHB1YmxpYyByZW5kZXIoKTogSlNYLkVsZW1lbnQge1xuICAgICAgICBsZXQgaW5kaWNhdG9yOiBTY2hlZHVsZVRvVXNlck1hcCA9IHt9XG4gICAgICAgIGlmICh0aGlzLnByb3BzLmRhdGEpIHtcbiAgICAgICAgICAgIGluZGljYXRvciA9IGZsYXR0ZW5UYXNrU2NoZWR1bGUodGhpcy5wcm9wcy5kYXRhKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJveGVzID0gdGhpcy5nZW5lcmF0ZUJveGVzKGluZGljYXRvcilcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFZpZXcgc3R5bGU9e3N0eWxlcy5jb250YWluZXJ9PlxuICAgICAgICAgICAgICAgIDxWaWV3IHN0eWxlPXtzdHlsZXMuY29udGFpbmVyTW9udGhTZWxlY3Rpb259PlxuICAgICAgICAgICAgICAgICAgICA8TW9udGhTZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uTW9udGhDaGFuZ2U9e3RoaXMub25Nb250aENoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb250aD17dGhpcy5zdGF0ZS5jdXJyZW50TW9udGh9XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50WWVhcj17dGhpcy5zdGF0ZS5jdXJyZW50WWVhcn1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICAgICAgICAgPFZpZXcgc3R5bGU9e3N0eWxlcy5jb250YWluZXJXZWVrZGF5fT5cbiAgICAgICAgICAgICAgICAgICAgPFdlZWtEYXlIZWFkZXIgLz5cbiAgICAgICAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICAgICAgICAgPFZpZXdcbiAgICAgICAgICAgICAgICAgICAgb25MYXlvdXQ9e3RoaXMuY29udGFpbmVyT25MYXlvdXR9XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlPXtzdHlsZXMuY29udGFpbmVyRGF0ZXN9PlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib3hlcy5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgPC9WaWV3ID5cbiAgICAgICAgICAgIDwvVmlldz5cblxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbk1vbnRoQ2hhbmdlID0gKG1vbnRoOiBNb250aCwgeWVhcjogbnVtYmVyKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgY3VycmVudE1vbnRoOiBtb250aCxcbiAgICAgICAgICAgIGN1cnJlbnRZZWFyOiB5ZWFyLFxuICAgICAgICAgICAgc2VsZWN0ZWREYXRlOiB1bmRlZmluZWRcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uRGF0ZVByZXNzID0gKGRhdGU6IERhdGVOdW1iZXIpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzZWxlY3RlZERhdGU6IGRhdGVcbiAgICAgICAgfSlcbiAgICB9XG59XG4iXX0=